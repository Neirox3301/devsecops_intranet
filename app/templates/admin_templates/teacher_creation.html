<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>

<style>
    .class-box {
      border: 1px solid #ccc;
      padding: 10px;
      margin: 5px 0;
      cursor: pointer;
      background-color: #f9f9f9;
    }
    .subjects { 
      display: none; 
      margin-left: 20px; 
    }
    ul {
      list-style-type: none;
      padding: 0;
    }
    .subject-label {
      display: flex;
      align-items: center;
      gap: 10px; /* Espacement entre la case et le texte */
      padding: 5px;
      cursor: pointer; /* Rend tout le label cliquable */
      border-radius: 5px;
    }
    .subject-label:hover {
      background-color: #e0e0e0; /* Effet au survol */
    }
</style>

<body>
  {% if error_message %}
    <p style="color: red;">{{ error_message }}</p>
  {% endif %}

  <form action="{{ url_for('.create_teacher') }}" method="POST">
    <input type="text" placeholder="First Name" name="first_name">
    <input type="text" placeholder="Last Name" name="last_name">
    
    <h1>Compétences</h1>
    <ul>
      {% for subject in subjects %}
      <li class="class-box">
        <label>
          <!-- La valeur correspond à l'id de la compétence -->
          <input type="checkbox" name="subjects" value="{{ subject.id }}"> {{ subject.name }}
        </label>
      </li>
      {% endfor %}
    </ul>

    <h1>Liste des Classes</h1>
    <ul>
      {% for class in classes %}
      <li class="class-box" data-class-id="{{ class.id }}" onclick="toggleSubjects('{{ class.id }}', event)">
        {{ class.name }}
        <div id="subjects-{{ class.id }}" class="subjects">
          {% for subject in subjects %}
          <label class="subject-label">
            <!-- Le nom est construit pour extraire l'id de la matière -->
            <input type="checkbox" name="{{ class.id }}|{{ subject.id }}"> {{ subject.name }}
          </label>
          {% endfor %}
        </div>
      </li>
      {% endfor %}
    </ul>
    <button type="submit">Create</button>
  </form>
</body>

<script>
    document.addEventListener("DOMContentLoaded", function() {
      // A set to store the checked skills
      let checkedSkills = new Set();

      // Get all the checkboxes for the skills
      const competenceCheckboxes = document.querySelectorAll("input[name='subjects']");
      competenceCheckboxes.forEach(function(checkbox) {
        checkbox.addEventListener("change", function() {
          if (checkbox.checked) {
            checkedSkills.add(checkbox.value);
          } else {
            checkedSkills.delete(checkbox.value);
          }
          // Update the display of the subjects for all open classes
          updateOpenClassSubjects();
        });
      });

      // Update the display of the subjects for all open classes
      function updateOpenClassSubjects() {
        // Get all the open class containers
        const openContainers = document.querySelectorAll(".subjects");
        openContainers.forEach(function(container) {
          // If the container is open
          if (container.style.display === 'block') {
            let subjectLabels = container.querySelectorAll(".subject-label");
            subjectLabels.forEach(function(label) {
              let input = label.querySelector("input");
              // The name is at the format classId|subjectId
              let parts = input.name.split("|");
              let subjectId = parts[1];
              // If the subject is checked, display it, otherwise hide it
              if (checkedSkills.has(subjectId)) {
                label.style.display = "block";
              } else {
                label.style.display = "none";
                input.checked = false; // Uncheck the checkbox
              }
            });
          }
        });
      }

      // Function to toggle the subjects for a class
      window.toggleSubjects = function(classId, event) {
        event.stopPropagation(); // Empêche la propagation de l'événement
        let container = document.getElementById('subjects-' + classId);
        if (container.style.display === '' || container.style.display === 'none') {
          // Update the display of each subject for this class
          let subjectLabels = container.querySelectorAll(".subject-label");
          subjectLabels.forEach(function(label) {
            let input = label.querySelector("input");
            let parts = input.name.split("|");
            let subjectId = parts[1];
            if (checkedSkills.has(subjectId)) {
              label.style.display = "block";
            } else {
              label.style.display = "none";
              input.checked = false;
            }
          });
          container.style.display = 'block';
        } else {
          container.style.display = 'none';
        }
      };
    });
</script>

</html>
